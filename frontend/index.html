<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cyber Defenders Dashboard</title>
  <style>
    body { background: #0d1117; color: #e6edf3; font-family: 'Inter', sans-serif; margin: 0; padding: 0; }
    header, nav { background: #161b22; padding: 10px; text-align: center; }
    .category { display: inline-block; margin: 0 10px; cursor: pointer; color: #58a6ff; }
    #content { padding: 20px; display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; }
    .card { background: #21262d; border-radius: 10px; padding: 15px; }
    .title { font-weight: bold; color: #58a6ff; }
  </style>
</head>
<body>
  <header><h1>🧠 Cyber Defenders Dashboard</h1></header>
  <nav>
    <span class="category">🌍 Internasjonalt</span>
    <span class="category">🇳🇴 Norge</span>
    <span class="category">📑 Rapporter</span>
    <span class="category">💬 Sosiale</span>
    <span class="category">🔬 Teknisk</span>
    <span class="category">🇷🇺 Russland</span>
    <span class="category">🇨🇳 Kina</span>
  </nav>
  <section id="content">Laster data...</section>

  <script>
    async function getLatestJsonUrl() {
      const apiUrl = "https://api.github.com/repos/xv68yq687p-max/AI-generated-CDD/contents/data";
      const res = await fetch(apiUrl);
      const files = await res.json();

      // Filtrer ut JSON-filer
      const jsonFiles = files
        .filter(f => f.name.endsWith(".json"))
        .map(f => f.name)
        .sort()
        .reverse(); // nyeste først

      if (jsonFiles.length === 0) return null;

      const latestFile = jsonFiles[0];
      return `https://raw.githubusercontent.com/xv68yq687p-max/AI-generated-CDD/main/data/${latestFile}`;
    }

    async function loadData() {
      const container = document.getElementById("content");
      container.innerHTML = "Laster data...";

      try {
        const latestUrl = await getLatestJsonUrl();
        if (!latestUrl) {
          container.innerHTML = "Ingen JSON-filer funnet i repoet.";
          return;
        }

        const res = await fetch(latestUrl);
        const data = await res.json();

        if (!data.events) {
          container.innerHTML = "Ingen data funnet i nyeste fil.";
          return;
        }

        container.innerHTML = data.events.map(evt => `
          <div class="card">
            <div class="title">${evt.title}</div>
            <div>${evt.summary}</div>
            <small>${evt.source.name} · ${new Date(evt.timestamp).toLocaleString()}</small>
          </div>
        `).join('');

      } catch (err) {
        console.error(err);
        container.innerHTML = "Kunne ikke laste data. Sjekk GitHub-repoet.";
      }
    }

    loadData();
  </script>
</body>
</html>
